<ion-content fullscreen="true" class="pagina-mesa">
  <div [ngClass]="{ 'mesa-verificada': mesaVerificada }">
    <!-- Encabezado -->
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="primary" class="toolbar-center">
          <ion-button
            class="boton-home"
            (click)="volverAtras()"
            [disabled]="modalAlerta"
          >
            <ion-icon name="home-outline" class="icono-home"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <!-- Escaneo QR -->
    <div class="scanner-container" *ngIf="!mesaVerificada">
      <ion-icon name="checkbox-outline" class="icono-qr"></ion-icon>

      <ion-button
        expand="block"
        class="boton-escanear"
        (click)="escanearQR()"
        [disabled]="procesando || modalAlerta"
      >
        <ion-icon name="qr-code-outline" slot="start"></ion-icon>
        {{ procesando ? 'Procesando...' : 'Escanear código QR para ingresar a su
        mesa' }}
        <ion-spinner slot="end" *ngIf="procesando"></ion-spinner>
      </ion-button>
    </div>

    <!-- Acciones si ya está verificado -->
    <div class="scanner-container" *ngIf="mesaVerificada">
      <div class="mesa-numero">
        <p>{{ mesaAsignada }}</p>
      </div>

      <ion-img
        src="assets/mesa.png"
        class="imagen-mesa"
        alt="Mesa confirmada"
      ></ion-img>

      <!-- Mostrar REALIZAR PEDIDO solo si no hay pedido -->
      <ion-button
        expand="block"
        class="boton-opcion"
        routerLink="/menu"
        *ngIf="estadoPedido === 'ninguno'"
        [disabled]="modalAlerta"
      >
        Realizar pedido
      </ion-button>

      <!-- Mostrar VER ESTADO solo si hay pedido pendiente o confirmado -->
      <ion-button
        expand="block"
        class="boton-opcion"
        (click)="verEstadoDelPedido()"
        *ngIf="estadoPedido !== 'ninguno'"
        [disabled]="modalAlerta"
      >
        Ver estado del pedido
      </ion-button>

      <!-- Botón para consultar al mozo -->
      <ion-button
        expand="block"
        class="boton-opcion"
        [routerLink]="['/chat']"
        [queryParams]="{ mesa: mesaAsignada }"
        [disabled]="modalAlerta"
      >
        Consulta al mozo
      </ion-button>
    </div>

    <!-- Alerta flotante -->
    <div class="alerta-overlay" *ngIf="modalAlerta">
      <div class="alerta-flotante">
        <h2>{{ tituloAlerta }}</h2>
        <pre>{{ mensajeAlerta }}</pre>
        <ion-button
          size="small"
          expand="block"
          class="boton-cerrar-alerta"
          (click)="mostrarModalAlerta(false)"
        >
          Aceptar
        </ion-button>
      </div>
    </div>
  </div>
</ion-content>

<!-- BOTONES DE PRUEBA -->
<div class="botones-test">
  <ion-button
    fill="outline"
    size="small"
    color="success"
    (click)="simularQR(true)"
  >
    Simular QR correcto
  </ion-button>
  <ion-button
    fill="outline"
    size="small"
    color="danger"
    (click)="simularQR(false)"
  >
    Simular QR incorrecto
  </ion-button>
</div>

<div class="botones-test">
  <ion-button
    fill="outline"
    size="small"
    color="warning"
    (click)="simularCambioEstadoPedido('pendiente')"
  >
    Simular pedido pendiente
  </ion-button>
  <ion-button
    fill="outline"
    size="small"
    color="tertiary"
    (click)="simularCambioEstadoPedido('confirmado')"
  >
    Simular pedido confirmado
  </ion-button>
  <ion-button
    fill="outline"
    size="small"
    color="medium"
    (click)="simularCambioEstadoPedido('ninguno')"
  >
    Reset estado de pedido
  </ion-button>
</div>
