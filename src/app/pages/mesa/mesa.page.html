<ion-content fullscreen="true" class="pagina-mesa" [class.mesa-verificada]="mesaVerificada">
  <div>
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="primary" class="toolbar-center">
          <ion-button class="boton-home" (click)="volverAtras()" [disabled]="modalAlerta">
            <ion-icon name="home-outline" class="icono-home"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <!-- QR NO verificado -->
    <div class="scanner-container" *ngIf="!mesaVerificada">
      <ion-icon name="checkbox-outline" class="icono-qr elicono"></ion-icon>
      <ion-button expand="block" class="boton-escanear" (click)="escanearQR()" [disabled]="procesando || modalAlerta">
        <ion-icon name="qr-code-outline" slot="start"></ion-icon>
        {{ procesando ? 'Procesando...' : 'Escanear c√≥digo QR para ingresar a su mesa' }}
        <ion-spinner slot="end" *ngIf="procesando"></ion-spinner>
      </ion-button>
    </div>

    <!-- QR verificado -->
    <div class="scanner-container" *ngIf="mesaVerificada">
      <div class="mesa-numero">
        <p>{{ mesaAsignada }}</p>
      </div>

      <ion-img src="assets/mesa.png" class="imagen-mesa" alt="Mesa confirmada"></ion-img>

      <!-- ESTADO: NINGUNO -->
      <ion-button
        expand="block"
        class="boton-opcion"
        *ngIf="estadoPedido === 'ninguno' && !pedidoIniciadoLocalmente"
        (click)="iniciarPedido()"
      >
        Realizar pedido
      </ion-button>

      <ion-button
        expand="block"
        disabled
        class="boton-opcion"
        [routerLink]="['/estado-pedido']"
        [queryParams]="{ mesa: mesaAsignada }"
        *ngIf="pedidoIniciadoLocalmente && estadoPedido === 'ninguno'"
      >
        Pedido Pendiente a confirmar
      </ion-button>

      <!-- ESTADO: CONFIRMADO -->
      <ion-button
        expand="block"
        class="boton-opcion"
        (click)="verEstadoPedidoEscaneandoQR()"
        *ngIf="estadoPedido === 'confirmado'"
      >
        Ver estado del pedido
      </ion-button>

      <!-- ESTADO: ENTREGADO -->
      <ion-button
        expand="block"
        class="boton-grande"
        (click)="verEstadoPedidoEscaneandoQR()"
        *ngIf="estadoPedido === 'entregado'"
      >
        Juegos
      </ion-button>

      <ion-button
        expand="block"
        class="boton-grande"
        *ngIf="estadoPedido === 'entregado'"
        (click)="EscanearPago()"
      >
        Pedir Cuenta
      </ion-button>

      <!-- CONSULTA AL MOZO -->
      <ion-button
        expand="block"
        class="boton-grande"
        [routerLink]="['/chat']"
        [queryParams]="{ mesa: mesaAsignada }"
      >
        Consulta al mozo
      </ion-button>

      <!-- ENCUESTA -->
      @if (this.hizoEncuesta) {
        <ion-button expand="block" class="boton-escanear" [disabled]="procesando" routerLink="/resultados-encuestas">
          <ion-icon name="newspaper-outline" slot="start"></ion-icon>
          Ver encuestas de otros clientes
        </ion-button>
      } @else {
        <ion-button
          expand="block"
          class="boton-grande"
          [routerLink]="['/encuesta']"
          [queryParams]="{ mesa: mesaAsignada }"
          *ngIf="estadoPedido === 'entregado'"
        >
          Realizar encuesta
        </ion-button>
      }
    </div>

    <!-- MODAL ALERTA -->
    <div class="alerta-overlay" *ngIf="modalAlerta">
      <div
        class="alerta-flotante"
        [ngClass]="{
          'alerta-exito': tipoAlerta === 'exito',
          'alerta-error': tipoAlerta === 'error'
        }"
      >
        <h2>{{ tituloAlerta }}</h2>
        <p>{{ mensajeAlerta }}</p>
        <ion-button
          size="small"
          expand="block"
          class="boton-cerrar-alerta"
          (click)="mostrarModalAlerta(false)"
        >
          Aceptar
        </ion-button>
      </div>
    </div>
  </div>
</ion-content>
