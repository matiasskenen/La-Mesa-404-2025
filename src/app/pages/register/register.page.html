<ion-content [fullscreen]="true" class="fondo">
  <!-- HEADER CON BOTÓN VOLVER -->
  <ion-header>
    <ion-toolbar>
      <ion-buttons slot="primary" class="toolbar-center">
        <ion-button class="boton-home" (click)="volverAtras()">
          <ion-icon name="arrow-back-circle-outline" class="icono-home"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <!-- MENSAJE DE ERROR GENERAL -->
  <div class="mensaje-error" *ngIf="mensajeError">
    <ion-text color="danger">
      <p>{{ mensajeError }}</p>
    </ion-text>
  </div>

  <!-- SPINNER DE CARGA -->
  <div *ngIf="subiendoImagen" class="spinner-overlay">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Subiendo imagen, por favor espere...</p>
  </div>

  <!-- FORMULARIO DE REGISTRO DE CLIENTE -->
  <form [formGroup]="formCliente" (ngSubmit)="guardarCliente()">
    <!-- Nombre -->
    <div class="input-group">
      <ion-item>
        <ion-input class="placeholder-negro" formControlName="nombre" placeholder="Nombre"></ion-input>
      </ion-item>
      <div class="error-tooltip" *ngIf="formCliente.get('nombre')?.touched && formCliente.get('nombre')?.invalid">
        <span *ngIf="formCliente.get('nombre')?.hasError('required')">El nombre es obligatorio</span>
      </div>
    </div>

    <!-- Apellido -->
    <div class="input-group">
      <ion-item>
        <ion-input class="placeholder-negro" formControlName="apellido" placeholder="Apellido"></ion-input>
      </ion-item>
      <div class="error-tooltip" *ngIf="formCliente.get('apellido')?.touched && formCliente.get('apellido')?.invalid">
        <span *ngIf="formCliente.get('apellido')?.hasError('required')">El apellido es obligatorio</span>
      </div>
    </div>

    <!-- DNI + Botón QR -->
    <div class="input-group">
      <ion-item>
        <ion-input class="placeholder-negro" type="number" formControlName="dni" placeholder="DNI"></ion-input>
        <ion-button fill="clear" slot="end" (click)="escanearQR()">
          <ion-icon name="qr-code-outline" size="large" color="light"></ion-icon>
        </ion-button>
      </ion-item>
      <div class="error-tooltip" *ngIf="formCliente.get('dni')?.touched && formCliente.get('dni')?.invalid">
        <span *ngIf="formCliente.get('dni')?.hasError('required')">El DNI es obligatorio</span>
        <span *ngIf="formCliente.get('dni')?.hasError('minlength')">Debe tener al menos 7 dígitos</span>
      </div>
    </div>

    <!-- CUIL -->
    <div class="input-group">
      <ion-item>
        <ion-input class="placeholder-negro" type="number" formControlName="cuil" placeholder="CUIL"></ion-input>
      </ion-item>
      <div class="error-tooltip" *ngIf="formCliente.get('cuil')?.touched && formCliente.get('cuil')?.invalid">
        <span *ngIf="formCliente.get('cuil')?.hasError('required')">El CUIL es obligatorio</span>
        <span *ngIf="formCliente.get('cuil')?.hasError('minlength')">Debe tener 11 dígitos</span>
      </div>
    </div>

    <!-- Email -->
    <div class="input-group">
      <ion-item>
        <ion-input class="placeholder-negro" type="email" formControlName="email" placeholder="Correo electrónico"></ion-input>
      </ion-item>
      <div class="error-tooltip" *ngIf="formCliente.get('email')?.touched && formCliente.get('email')?.invalid">
        <span *ngIf="formCliente.get('email')?.hasError('required')">El email es obligatorio</span>
        <span *ngIf="formCliente.get('email')?.hasError('email')">Formato inválido</span>
      </div>
    </div>

    <!-- Contraseña -->
    <div class="input-group">
      <ion-item>
        <ion-input class="placeholder-negro" type="password" formControlName="password" placeholder="Contraseña"></ion-input>
      </ion-item>
      <div class="error-tooltip" *ngIf="formCliente.get('password')?.touched && formCliente.get('password')?.invalid">
        <span *ngIf="formCliente.get('password')?.hasError('required')">Contraseña obligatoria</span>
        <span *ngIf="formCliente.get('password')?.hasError('minlength')">Mínimo 6 caracteres</span>
      </div>
    </div>

    <!-- Confirmar contraseña -->
    <div class="input-group">
      <ion-item>
        <ion-input class="placeholder-negro" type="password" formControlName="confirmar" placeholder="Confirmar contraseña"></ion-input>
      </ion-item>
      <div class="error-tooltip" *ngIf="formCliente.get('confirmar')?.touched && formCliente.get('confirmar')?.invalid">
        <span *ngIf="formCliente.get('confirmar')?.hasError('required')">Debe confirmar la contraseña</span>
      </div>
    </div>

    <!-- Vista previa imagen + Eliminar -->
    <div *ngIf="imagenPreviewUrl" class="imagen-preview-container">
      <img [src]="imagenPreviewUrl" class="imagen-preview" alt="Imagen seleccionada" />
      <ion-button expand="block" color="danger" (click)="borrarImagen()">
        <ion-icon slot="start" name="trash-outline"></ion-icon>
        Eliminar imagen
      </ion-button>
    </div>

    <!-- Subir imagen -->
    <ion-button expand="block" color="medium" (click)="seleccionarFuenteImagen()">
      <ion-icon slot="start" name="camera-outline"></ion-icon>
      Subir imagen
    </ion-button>

    <!-- Botón REGISTRARSE -->
    <ion-button expand="block" type="submit" color="success" [disabled]="!formularioValido()">
      REGISTRARSE
    </ion-button>
  </form>

  <!-- MODAL DE ALERTA -->
  <div class="alerta-overlay" *ngIf="modalAlerta">
    <div class="alerta-flotante" [ngClass]="tipoAlerta">
      <h2>{{ tituloAlerta }}</h2>
      <p>{{ mensajeAlerta }}</p>
      <ion-button size="small" expand="block" class="boton-cerrar-alerta" [ngClass]="tipoAlerta" (click)="mostrarModalAlerta(false)">
        Aceptar
      </ion-button>
    </div>
  </div>
</ion-content>
